---
文档类型: 使用手册
创建日期: 2026-02-05
最后更新: 2026-02-05
维护人: X28技术团队
文档版本: v0.1
适用范围: 游戏逻辑 - 地图与地形 - 实体装配工具
状态: 草案
---

# 实体装配工具 使用手册

# 1 工具定位

- 用途：帮助地图作者在地图上放置实体、选择模板并配置 Overrides，同时提供校验与预览能力。
- 输出：MapConfig 中的 Entities 列表（或其片段），由地图加载阶段叠加合并并在 LoadMap 时生成实体。

# 2 典型用户故事

- 故事 1：关卡作者放置出生点
  - 作为“关卡作者”，我可以选择模板 `moba_hero` 并在地图上点击放置。
  - 我可以在 UI 中编辑 Overrides（例如位置、名称、初始阵营）。
  - 我保存后，地图加载时会生成对应实体，并且 Overrides 覆盖模板默认值。

- 故事 2：技术策划批量覆盖属性
  - 作为“技术策划”，我可以对一组实体批量修改同一字段的 Overrides（例如生命值、移动速度），并导出为一个 map overlay 片段。

# 3 后端接口（目标口径）

- GET Templates
  - 出参：模板列表与组件 schema（用于前端生成表单）
- GET MapEntities(mapId)
  - 出参：Entities 列表（Template + Overrides）
- PUT/POST MapEntities(mapId)
  - 入参：Entities 列表或补丁（增删改）
  - 出参：校验报告（未知模板/未知组件/字段类型错误）

# 4 校验与诊断

- 校验项：
  - TemplateId 存在
  - Overrides 中的 componentName 在 ComponentRegistry 中可解析
  - overrides 数据结构符合组件 schema（字段名/类型）
- 失败策略：
  - 错误必须包含 mapId、entityIndex、templateId、componentName 与证据路径。

# 5 与运行时装配流程的关系

- 运行时顺序固定：模板先 → Overrides 后（同名覆盖）。
- Entities 的叠加发生在 MapConfig 合并阶段：Core/Mods/Parent 的 Entities 列表会追加合并，最终在 LoadEntities 中逐条生成实体。
