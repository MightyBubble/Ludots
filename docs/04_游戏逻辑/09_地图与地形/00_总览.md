---
文档类型: 总览入口
创建日期: 2026-02-05
最后更新: 2026-02-05
维护人: X28技术团队
文档版本: v0.1
适用范围: 游戏逻辑 - 地图与地形 - 目录入口
状态: 草案
---

# 地图与地形 总览

# 1 本目录定位
## 1.1 读者与范围

- 读者：需要接入地图数据、实现地形表现/导航、或扩展 Mod 地图内容的开发者。
- 范围：MapConfig（地图配置/实体装配）+ 地形几何数据（WorldMap/VertexMap）+ 加载编排（GameEngine/MapManager/MapLoader/VFS）。

## 1.2 本目录边界

- 本目录只讨论“地图数据与加载”，不包含玩法系统逻辑（例如单位 AI、战斗结算）。
- 地图加载完成后的玩法初始化入口统一为 `GameEvents.MapLoaded` 事件；禁止旁路直接依赖“某个系统恰好在某帧已就绪”。

## 1.3 推荐阅读顺序

- 新同学：先读 `01_架构设计/01_地图加载流程.md` → `02_接口规范/01_地图数据结构.md` → `01_架构设计/02_六边形地图系统.md`
- 需要落地导航/渲染：`01_架构设计/02_六边形地图系统.md` → `01_架构设计/06_Graph路网系统.md` → `01_架构设计/04_地形分析.md`
- 需要落地天气/流场：`01_架构设计/05_Grid地图系统.md` → `02_接口规范/02_地图数据集与叠加口径.md`
- 需要编写地图初始实体：`01_架构设计/07_地图实体装配流程.md`

# 2 SSOT
## 2.1 代码入口

- `src/Core/Engine/GameEngine.cs`：地图加载编排入口（LoadMap/LoadVertexMap）与 MapLoaded 事件触发点
- `src/Core/Map/MapManager.cs`：MapConfig 多源片段收集与合并（Core + Mods）
- `src/Core/Systems/MapLoader.cs`：基于模板的实体装配（EntityBuilder + templates.json）
- `src/Core/Map/Hex/VertexMap*.cs`：地形几何真源（VertexMap + 二进制读写）
- `src/Core/Map/WorldMap.cs`：网格/Tile 形式的地形数据（当前与 VertexMap 并存）

## 2.2 口径说明

- “地图”在当前版本拆为两类真源与若干可选数据集：
  - MapConfig：地图内容编排（实体模板、Overrides、标签、依赖、可选数据集清单）
  - 地形真源（Hex）：VertexMap（可选；每个最终 MapConfig 只允许 1 份 Vertex 真源）
  - 额外数据集（可选/可叠加）：Grid（粗/细场数据）、Graph（路网，多层 + overlay）
- Core 与 Mods 的资源寻址统一走 VFS（`ModId:relative/path`），加载顺序由 MapManager/GameEngine 明确控制。

## 2.3 关键约束

- 单一真实来源：地图配置合并口径固定在 MapManager；地形二进制读取口径固定在 GameEngine.LoadVertexMap。
- 加载边界清晰：MapLoaded 是切图后续逻辑唯一入口；地图加载阶段不执行玩法逻辑。
- 失败策略：目标口径为加载期 fail-fast（缺文件/版本不匹配直接失败并可定位）。当前代码存在静默吞错，详见对齐报告。

# 3 子文档索引
## 3.1 子文档清单

- `01_架构设计/01_地图加载流程.md`
- `01_架构设计/02_六边形地图系统.md`
- `01_架构设计/03_地图生成器.md`
- `01_架构设计/04_地形分析.md`
- `01_架构设计/05_Grid地图系统.md`
- `01_架构设计/06_Graph路网系统.md`
- `01_架构设计/07_地图实体装配流程.md`
- `01_架构设计/08_地图数据初始化时序.md`
- `02_接口规范/01_地图数据结构.md`
- `02_接口规范/02_地图数据集与叠加口径.md`
- `05_对齐报告/01_地图架构对齐报告.md`
- `05_对齐报告/02_地图多数据集加载对齐报告.md`
- `07_使用手册/00_总览.md`
- `99_KANBAN.md`

## 3.2 文档类型与阅读路径

- 架构设计：`01_架构设计/*`（含“当前代码现状/差距清单/迁移策略”）
- 接口规范：`02_接口规范/*`（用于定义 schema/格式/字段与失败口径）
- 对齐报告：`05_对齐报告/*`（阶段性审计结论、差异表与行动项）
