---
文档类型: 配置结构
创建日期: 2026-02-05
最后更新: 2026-02-05
维护人: X28技术团队
文档版本: v0.1
适用范围: 高级逻辑 - 效用AI系统 - 配置结构 - 响应曲线
状态: 草案
---

# 响应曲线（ResponseCurve）配置结构

# 1 概述
## 1.1 本文档定义

本文档定义响应曲线（`ResponseCurve`，效用曲线）的配置结构、加载期强校验与版本策略。响应曲线是纯数值映射：把归一化输入 `x`（0..1）映射为 `y`（0..1），不承载任何业务语义。

## 1.2 使用场景与边界

使用场景：

- 考量项（`Consideration`）对归一化输入的打分：`score = curve.Evaluate(normalizedInput)`。
- 支持 UGC/Mod 注入不同曲线形状，驱动效用AI的评分行为。

边界：

- 响应曲线不读取 Attribute/Tag/Blackboard，不做 gate 与聚合。
- 曲线求值必须是 O(1) 或 O(K)（K 为加载期固定的小常量），不得与候选数量/决策数量耦合。

## 1.3 关联运行时消费点

- `docs/05_高级逻辑/12_效用AI系统/01_架构设计/02_效用AI_架构设计.md`
- `docs/05_高级逻辑/12_效用AI系统/03_配置结构/02_效用AI配置_配置结构.md`

# 2 文件位置与命名
## 2.1 目录位置

推荐路径（待与 Mod/VFS 目录规范对齐后固化）：

- `Content/Behavior/Curves/`

## 2.2 命名规则

- 文件名：`{CurveId}.json`
- CurveId 必须是稳定 ID（不依赖显示名），用于跨配置引用与存档一致性。

## 2.3 发现与加载机制

- 加载期扫描配置目录，建立 `CurveRegistry`（CurveId → 结构化曲线）。
- 加载期完成所有强校验与烘焙；运行态只读消费，不允许动态解析字符串。

# 3 完整示例
## 3.1 最小可用示例

```json
{
  "version": 1,
  "id": 3001,
  "kind": "PiecewiseLinear",
  "keys": [
    { "x": 0.0, "y": 0.0 },
    { "x": 1.0, "y": 1.0 }
  ]
}
```

## 3.2 常见变体

- 反转：`(0,1)` 到 `(1,0)` 的线性段。
- 死区：前半段 y=0，后半段逐渐上升。
- 阶梯：用多段线近似阶梯，但 keys 数量必须有上限。

# 4 字段说明

| 字段 | 类型 | 必填 | 默认值 | 说明 |
|---|---|---:|---|---|
| version | int | 是 | - | 配置版本号（见 §6） |
| id | int | 是 | - | CurveId（稳定 ID） |
| kind | string(enum) | 是 | - | 曲线类型（受枚举约束） |
| keys | array | 视 kind | [] | 分段曲线控制点（受上限约束） |

Key 字段：

| 字段 | 类型 | 必填 | 默认值 | 说明 |
|---|---|---:|---|---|
| x | float | 是 | - | 输入采样点（建议 0..1，加载期强校验） |
| y | float | 是 | - | 输出值（建议 0..1，加载期强校验） |

# 5 校验规则
## 5.1 加载期强校验

必须 fail-fast：

- version/id 缺失或非法（非正数/重复）
- kind 不在枚举内
- keys 数量超过上限（建议 8/16，必须在加载期裁决并写死）
- keys 未按 x 严格递增排序
- x 或 y 不在允许范围内（默认要求 0..1；若允许超界，必须显式写入 kind 的规则并强校验）

## 5.2 错误信息与诊断

错误信息必须包含：

- 配置文件相对路径
- CurveId
- 失败字段路径（例如 `keys[4].x`）
- 失败原因（枚举非法/超上限/未排序/越界）

# 6 版本兼容性
## 6.1 版本号策略

- `version` 为整数递增。
- 不允许静默兼容旧字段名；破坏性变更必须提升 version。

## 6.2 破坏性变更与迁移方式

- 破坏性变更必须提供离线迁移工具或加载期显式迁移步骤，并在迁移失败时 fail-fast。
- 运行态不得悄悄接受旧格式或进行隐式 fallback。
