---
文档类型: 裁决条款
创建日期: 2026-02-05
最后更新: 2026-02-05
维护人: X28技术团队
文档版本: v0.1
适用范围: 高级逻辑 - 避障与Steering - 更新频率与退化策略
状态: 已裁决
依赖文档:
  - docs/00_文档总览/规范/14_裁决条款.md
  - docs/02_核心引擎/03_TimeSlice与分帧策略/01_TimeSlice与分帧策略_架构设计.md
  - docs/03_基础服务/06_空间服务/02_接口规范/01_空间查询接口_接口规范.md
---

# 更新频率与退化策略 裁决条款

# 1 裁决背景

## 1.1 背景问题与约束

避障与 steering 属于高频、强预算系统。在实体数量极大或高密场景下，空间候选会溢出（Dropped>0）或计算预算耗尽；如果不做明确裁决，会出现：

- 裁决级结果受镜头/裁剪影响（不可回放）
- 静默丢弃导致“偶现穿模/相互挤压/战术差异”
- 因 wall-clock 驱动导致跨平台不一致

## 1.2 适用范围与边界

适用范围：近场避障/steering 相关系统的更新频率（targetHz/bucketing）与 dropped 退化策略。

边界：

- 空间查询接口与稳定序由空间服务 SSOT 定义，本裁决条款只定义“如何消费与退化”。  
  - `docs/03_基础服务/06_空间服务/02_接口规范/01_空间查询接口_接口规范.md`

# 2 裁决结论

## 2.1 必须遵守的规则

1. 必须区分 Non‑Cullable 与 Cullable：  
   - Non‑Cullable（裁决级）：不可裁剪、不可静默丢结果。  
   - Cullable（表现级）：允许降频/代理/丢弃，但必须可观测。  
2. 更新频率裁决真源是离散 tick（IClock）：  
   - 禁止使用 wall-clock 或浮点 dt 作为裁决真源。  
   - targetHz/bucketing/workUnits 只改变推进节奏，不改变裁决边界。  
3. 空间候选必须固定容量输出（Span）：  
   - Dropped 是硬信号，必须进入退化决策；禁止隐式扩容或全表扫描 fallback。  
4. 近场邻居选择必须固定容量 K：  
   - 从候选集中选择最近或最相关的 K 个邻居时，必须固化 tie-break（StableKey）。  
   - 禁止随容器遍历顺序变化导致结果抖动。  

## 2.2 例外条件与退出条件

例外：仅在纯表现层（Cullable）模块允许 dropped>0 时继续使用已填充候选集。

退出条件：一旦该模块被提升为 Non‑Cullable（影响裁决），必须切换到 Non‑Cullable 的退化路径。

# 3 裁决理由

## 3.1 为什么这样做

- Non‑Cullable 的一致性是回放、联机与测试的前提；必须禁止镜头/裁剪影响裁决。  
- dropped 是容量/预算不足的唯一可观测信号；静默忽略会形成不可追踪的战术差异。  
- 固定容量 K 是避免高密场景 O(N²) 退化的必要上限。  

## 3.2 放弃了哪些备选方案

- 放弃“buffer 不够就自动扩容”：破坏零 GC 与预算口径。  
- 放弃“缺索引时退化为全表扫描”：破坏预算与一致性视图。  
- 放弃“随手按距离排序但不固化 tie-break”：会破坏确定性。  

# 4 影响范围

## 4.1 受影响模块与代码入口

- 空间查询门面：`src/Core/Spatial/SpatialQueryService.cs`  
- 稳定序与去重：`src/Core/Spatial/SpatialQueryPostProcessor.cs`  
- 目标 Hz 分发参考：`src/Core/Engine/Physics2D/DiscreteRateTickDistributor.cs`  

## 4.2 迁移与过渡策略

1. 先把所有“近场避障/steering”调用点按 Non‑Cullable/Cullable 分类。  
2. 为 Non‑Cullable 调用点补齐 dropped 处理：二选一（熔断或显式降级），并写入 telemetry。  
3. 为 Cullable 调用点固化 targetHz/bucketing，并保证可观测 dropped。  
