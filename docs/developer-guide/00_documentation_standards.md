# 文档编写规范

本篇定义 `docs/developer-guide/` 下所有架构文档的写作标准，确保风格统一、信息准确、对读者友好。

## 1 读者假设

文档的读者是**了解 C# 和游戏开发基础，但不了解 Ludots 内部实现**的开发者。

*   不要假设读者参与过本项目的开发过程。
*   不要假设读者知道任何内部里程碑、迭代编号、工单编号或代号。
*   可以假设读者理解 ECS、定点数、Mod 等通用游戏开发概念。

## 2 禁止出现的内容

### 2.1 内部术语

文档面向所有开发者，以下内容**一律禁止**：

*   开发阶段编号（"Phase 1"、"第二阶段"、"v2 重构"等）
*   工单/分支编号（"#1234"、"BC-7642"等）
*   AI 工具署名（"由 GPT/Claude 生成"等）
*   内部讨论引用（"我们在会议中决定"、"按之前的讨论"等）

如果需要表达"某个功能替代了旧机制"，只描述当前行为和设计理由，不提及历史迭代。

**反例**：

> Phase 2 引入了 FireMapEvent 替代旧的全局广播。

**正例**：

> `FireMapEvent` 只触发指定 Map 的 Trigger，不会波及其他 Map。这种隔离避免了并存地图之间的事件串扰。

### 2.2 未验证的内容

*   不要写推测性描述（"应该"、"大概"、"可能是"）。
*   不要写与代码不一致的描述——如果不确定，先读代码再写文档。
*   不要复制 TODO 或计划中但未实现的功能。文档只描述已存在的行为。

## 3 文件命名与编号

*   文件名格式：`NN_snake_case_topic.md`，编号两位数，从 `00` 开始。
*   编号用于排列顺序，不代表重要性。新增文档取当前最大编号 +1。
*   编号确定后不再调整——删除文档时保留编号空缺，不重新排序。
*   所有新增文档必须同步更新 `README.md` 的目录。

## 4 文档结构

### 4.1 整体骨架

```markdown
# 标题（与文件名语义一致）

一段话说明本篇解决什么问题、覆盖哪些内容。

## 1 第一个主题

### 1.1 子主题

正文、代码示例、图表。

## 2 第二个主题

...

## N 相关文档

*   交叉引用列表
```

### 4.2 标题层级

| 层级 | 用途 | 示例 |
|------|------|------|
| `#` | 文档标题，每篇仅一个 | `# Trigger 开发指南` |
| `##` | 一级章节，带数字编号 | `## 3 事件触发点` |
| `###` | 二级章节，带层级编号 | `### 3.1 全局事件` |
| `####` | 偶尔用于小节内分点 | 尽量避免，优先用列表 |

章节编号使用阿拉伯数字，不要使用中文数字。一级编号从 `1` 开始。

### 4.3 开头段落

每篇文档的 H1 标题后紧跟一段概述，说明：

*   本篇讲什么（1-2 句）
*   读者读完能获得什么

不要写"本文将介绍……"这种空洞的导读。直接说主题和要解决的问题。

**反例**：

> 本文将详细介绍 Map 系统的方方面面。

**正例**：

> 本篇说明三件事：Map 与 Mod 的配置合并关系、地图并存与焦点栈模型、空间服务的热切换机制。

### 4.4 交叉引用

文档末尾统一放置"相关文档"列表，使用相对路径：

```markdown
相关文档：

*   启动顺序与入口点：见 [09_startup_entrypoints.md](09_startup_entrypoints.md)
*   Trigger 开发指南：见 [08_trigger_guide.md](08_trigger_guide.md)
```

正文中也可以内联引用，但不要过度——一段话中出现两个以上链接就影响阅读了。

## 5 代码示例

### 5.1 用途

代码示例用于**说明用法**，不是完整实现。只展示读者需要理解的部分。

*   每个示例都要能脱离上下文读懂——如果需要铺垫，在示例前用文字说明。
*   优先展示调用方视角（"怎么用"），而不是实现方视角（"怎么写的"）。

### 5.2 格式

*   始终标注语言标签（` ```csharp `、` ```json ` 等）。
*   示例中的占位符用 `/* ... */` 注释，不要用 `...` 省略号。
*   如果省略了大量代码，在注释中说明省略了什么。
*   去掉与主题无关的 `using` 语句，只保留帮助理解类型来源的。

### 5.3 关联源码位置

当描述引擎内部行为时，标注参考实现的源码路径：

```markdown
参考实现：`src/Core/Scripting/TriggerManager.cs`
```

路径从仓库根目录开始，不写绝对路径。不需要精确到行号——行号易过时。

## 6 图表与流程

### 6.1 ASCII 流程图

复杂执行顺序优先使用 ASCII 树形图，适合在终端和代码编辑器中阅读：

```
GameEngine.LoadMap(mapId)
  ├── MapManager.LoadMap → 合并 MapConfig
  ├── MapSessionManager.CreateSession
  ├── PushFocused(mapId) → 旧 focused 变 Suspended
  └── FireMapEvent(mapId, MapLoaded, ctx)
```

### 6.2 表格

适合对比性信息。列数控制在 2-4 列，内容简短：

```markdown
| API | 用途 |
|-----|------|
| `OnEvent(eventKey, handler)` | 注册事件回调 |
| `SystemFactoryRegistry` | 注册 System 工厂 |
```

单元格内容超过一行时，考虑改用列表。

## 7 语言风格

### 7.1 语言

所有文档使用**中文**。技术名词（类名、方法名、设计模式名）保留英文原文，不翻译。

*   正确：`FireMapEvent` 只触发指定 Map 的 Trigger
*   错误：触发地图事件方法只触发指定地图的触发器

### 7.2 语气

*   使用客观陈述，不用"我们"、"你"等人称（"引擎会……"而非"我们会……"）。
*   例外：操作指引中可以用"你"（"如果你需要修改优先级……"）。
*   不要使用感叹号。
*   不要使用 emoji。

### 7.3 句式

*   短句优先。一句话说一件事。
*   避免嵌套括号。
*   列表项保持平行结构——要么全是名词短语，要么全是动词开头的句子。

## 8 维护规则

### 8.1 何时更新文档

当代码变更影响了文档描述的行为时，**同一个提交或同一个 PR** 必须同步更新文档。不接受"先改代码后补文档"。

### 8.2 删除过时内容

如果某个机制被移除，直接删除对应描述。不要加删除线或"已废弃"标记——文档只描述当前行为。

### 8.3 README.md 同步

新增、删除或重命名文档时，必须同步更新 `docs/developer-guide/README.md` 的目录列表。

## 9 检查清单

提交文档前逐项确认：

*   [ ] 不含内部术语（阶段编号、工单号、AI 署名）
*   [ ] 不含推测性或未实现的内容
*   [ ] 代码示例可脱离上下文理解
*   [ ] 源码路径从仓库根目录开始
*   [ ] 章节编号连续、层级正确
*   [ ] 交叉引用的目标文件存在
*   [ ] README.md 目录已同步
