---
文档类型: 裁决条款
创建日期: 2026-02-05
最后更新: 2026-02-05
维护人: X28技术团队
文档版本: v0.1
适用范围: 基础服务 - 空间服务 - 可见性/TimeSlice
状态: 草案
依赖文档:
  - docs/00_文档总览/01_文档规范/14_裁决条款.md
---

# 可见性与分帧更新 裁决条款

# 1 裁决背景

## 1.1 背景问题与约束

在 64km 大世界里，最大的风险不是“平均帧耗”，而是“峰值帧耗”。
如果可见性与分帧更新没有统一裁决，上层系统会回退到实体级全表扫描与 HashSet 差分，从而出现不可控峰值。

## 1.2 适用范围与边界

适用范围：

- 相机裁剪候选集（Culling/LOD 的输入）
- 视野外/低优先级系统的降频（tick-rate）
- time-slice（按 cell/chunk 切片的分帧摊销）

边界：

- 本裁决不规定相机类型与渲染实现；只裁决输入输出口径与不可违反的规则。

# 2 裁决结论

## 2.1 必须遵守的规则

1. 可见性必须先按 cell/chunk 粗裁剪，禁止先做实体级全表扫描。
2. 表现域裁剪与玩法域空间查询必须解耦：
   - 玩法域：确定性（稳定序/去重/严格过滤）。
   - 表现域：允许近似/不排序，但必须固定容量 + dropped 可观测。
3. 分帧更新必须以逻辑 tick 为真源（tickIndex），禁止以渲染帧补步推导。
4. time-slice 的切片单位必须是 cell/chunk，并且 processedCells/processedEntities 必须有硬上限指标。

## 2.2 例外条件与退出条件

例外：在调试或工具场景允许执行额外开销的全量可见性计算，但必须满足：

- 只用于诊断与可视化，不作为运行时常态路径。
- 必须带显式开关，默认关闭。

退出条件：当调试路径进入生产配置或影响玩法/表现结果时，视为违规，必须移除或强制关闭。

# 3 裁决理由

## 3.1 为什么这样做

1. cell/chunk 粗裁剪把 N 变成“可见范围内候选”，是唯一可规模化的路径。
2. 玩法域与表现域对“确定性”与“成本上限”的优先级不同，不分离就会互相拖累。
3. tickIndex 真源能保证回放一致性；渲染帧补步无法保证跨平台与回放一致。

## 3.2 放弃了哪些备选方案

1. 以实体级 HashSet 差分作为主裁剪策略：在大世界会不可控。
2. 以“每 N 帧更新一次”的渲染帧口径实现降频：会破坏确定性。

# 4 影响范围

## 4.1 受影响模块与代码入口

- 相机裁剪：`src/Core/Systems/CameraCullingSystem.cs`
- 空间查询：`src/Core/Spatial/SpatialQueryService.cs`
- 空间索引策略：`docs/03_基础服务/06_空间服务/01_架构设计/02_空间索引策略_架构设计.md`

## 4.2 迁移与过渡策略

1. 在测试用例中固定“可见性粗裁剪 + time-slice”的观测指标与判定标准。
2. 优先让表现侧消费 VisibleCells/VisibleChunks，再逐步减少实体级过滤成本。

证据入口：

- 测试用例：`docs/03_基础服务/06_空间服务/06_测试用例/01_64km_空间服务_测试用例.md`
