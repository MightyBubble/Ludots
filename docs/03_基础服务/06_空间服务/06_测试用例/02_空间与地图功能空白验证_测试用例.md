---
文档类型: 测试用例
创建日期: 2026-02-09
最后更新: 2026-02-09
维护人: Claude
文档版本: v1.0
适用范围: 空间服务 + 地图系统功能空白验证 (SpatialFeatureGapTests.cs)
状态: 已实现
---

# 空间与地图功能空白验证测试用例

## 1 测试总览

| 维度 | 数量 |
|------|------|
| 测试文件 | `src/Tests/GasTests/SpatialFeatureGapTests.cs` |
| 测试方法 | 12 |
| 覆盖分类 | Rectangle/Line/HexRange/HexRing 查询, VertexMap 全层读写, 坐标转换, HexCoordinates 距离计算 |

## 2 测试方法清单

### 2.1 SpatialQueryService 形状查询

| 测试方法 | 验证内容 |
|----------|----------|
| `QueryRectangle_FindsEntitiesInRectangularArea` | 矩形区域查询命中范围内实体 |
| `QueryLine_FindsEntitiesAlongLine` | 线段查询沿方向搜索 |
| `QueryHexRange_FindsEntitiesWithinHexRadius` | 六角范围查询(HexRange) |
| `QueryHexRing_FindsEntitiesOnRingOnly` | 六角环查询(HexRing), 只在环上搜索 |
| `QueryAabb_EmptyWorld_ReturnsZero` | AABB 空世界边界条件 |

### 2.2 VertexMap 全层读写

| 测试方法 | 验证内容 |
|----------|----------|
| `VertexMap_AllLayers_ReadWriteRoundTrip` | 7 层全部写入/读取 round-trip (Height/Biome/Water/Vegetation/Blocked/Ramp/Faction) |
| `VertexMap_MultipleHexes_IndependentLayers` | 不同 hex 位置层数据独立性 |
| `VertexMap_BlockedAndRamp_ToggleOnOff` | 布尔层的 set/unset 切换 |

### 2.3 坐标转换

| 测试方法 | 验证内容 |
|----------|----------|
| `CoordinateConverter_GridToWorld_Roundtrips` | Grid → World → Grid 双向转换 |
| `CoordinateConverter_HexToWorld_Roundtrips` | Hex → World → Hex 双向转换 |

### 2.4 HexCoordinates 距离

| 测试方法 | 验证内容 |
|----------|----------|
| `HexCoordinates_Distance_Correct` | 非对称坐标距离公式正确性 |
| `HexCoordinates_SamePoint_DistanceZero` | 同点距离 = 0 |
| `HexCoordinates_Neighbors_AllAtDistanceOne` | 6 邻居全部距离 = 1 |

## 3 覆盖矩阵

| 能力项 | 已有测试覆盖 | 本次新增 |
|--------|-------------|----------|
| AABB 查询 | SpatialQueryServiceTests | 边界条件 |
| Radius 查询 | SpatialQueryServiceTests | - |
| Cone 查询 | SpatialQueryBackendParityTests | - |
| Rectangle 查询 | - | **新增** |
| Line 查询 | - | **新增** |
| HexRange 查询 | - | **新增** |
| HexRing 查询 | - | **新增** |
| VertexMap 全层 | VertexMapInterpolationTests (仅 Height) | **全 7 层新增** |
| Grid↔World 转换 | SpatialCoordinateConverterHexTests (Hex only) | **Grid 新增** |
| Hex 距离 | HexMetricsTests (metrics) | **距离公式新增** |
